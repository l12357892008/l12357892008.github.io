import{d as W,j as L,k as q,l as H,p as X,o as j,c as D,a as N,_ as O}from"./index-48cad54f.js";const U=W({__name:"barrageRain",setup(V){const u=L(),g=L();CanvasRenderingContext2D.prototype.roundRect=function(e,t,o,s,a){const l=Math.PI;this.beginPath(),this.arc(e+a,t+a,a,-l,-l/2),this.arc(e+o-a,t+a,a,-l/2,0),this.arc(e+o-a,t+s-a,a,0,l/2),this.arc(e+a,t+s-a,a,l/2,l),this.closePath()};let n,h=300,m=600;const w=[];let i=[];const r={height:70,fontSize:36,marginBottom:4,paddingX:8,avatarWidth:60,speed:1};let b;const x=()=>{const e=u.value;e.width=h=g.value.clientWidth,e.height=m=g.value.clientHeight,e.style.width=h+"px",e.style.height=m+"px";const t=Math.floor(m/(r.height+r.marginBottom));t<i.length?i.splice(t-i.length):i=[...i,...new Array(t-i.length).fill(!0)]},M=e=>{const{height:t,avatarWidth:o,marginBottom:s,paddingX:a,speed:l}=r,{t1:_,t2:d}=e;let c=A(),f="#ffffff",p=l,F=a,P=F+o+8;n.font=r.fontSize+"px PingFangSC-Regular";let C=P+Math.ceil(n.measureText(_).width)+8,I=C+Math.ceil(n.measureText(d).width)+a,E={value:e,color:f,row:c,top:c*(t+s),left:h,offset:p,width:[F,P,C,I]};w.push(E)},y=()=>{if(w.length){n.clearRect(0,0,h,m);for(let e=0,t;t=w[e];e++){if(t.left+t.width[3]<=0){w.splice(e,1),e--;continue}t.rowFlag||t.left+t.width[3]<h&&(i[t.row]!==void 0&&(i[t.row]=!0),t.rowFlag=!0),t.left-=t.offset,T(t)}}b=requestAnimationFrame(y)},T=e=>{const{height:t,avatarWidth:o}=r,{value:{img:s,t1:a,t2:l},color:_,left:d,top:c,width:f}=e;n.roundRect(d,c,f[3],t,t/2),n.fillStyle="rgba(0,0,0,0.5)",n.fill(),n.drawImage(s,0,0,s.width,s.height,d+f[0],c+(t-o)/2,o,o);let p=n.measureText(a).actualBoundingBoxAscent/2;n.font=r.fontSize+"px PingFangSC-Regular",n.fillStyle=_,n.fillText(a,d+f[1],c+t/2+p),n.fillStyle="#F24949",n.fillText(l,d+f[2],c+t/2+p)},A=()=>{const e=i.map((o,s)=>o?s:null).filter(o=>o!==null),t=e[Math.floor(Math.random()*e.length)];return i[t]=!1,t},k=()=>!!i.filter(t=>t).length,R=[{avatar:"https://image.duliday.com/living-cost/20200303/2a94df636b91ad15bbbb4408e2f285e4164115?roundPic/radius/66",t1:"张**三 给 李**四",t2:"红包"},{avatar:"https://image.duliday.com/living-cost/20200317/4cd9f827d439f7a1227501f9b09cd1e8622417?roundPic/radius/66",t1:"王**五 给 赵**六",t2:"红包"}];let v=0,S;const B=()=>{if(k()){var e=R[v++]||R[(v=0)||v++],t=new Image;t.setAttribute("crossOrigin","anonymous"),t.onload=function(){M({img:t,t1:e.t1,t2:e.t2})},t.src=e.avatar}S=setTimeout(function(){B()},1600)},z=q(()=>{console.log(123123),x()},300);return H(()=>{if(!(u.value&&g.value))return;n=u.value.getContext("2d"),n.font=r.fontSize+"px PingFangSC-Regular",window.addEventListener("resize",z),x(),B(),y()}),X(()=>{clearTimeout(S),cancelAnimationFrame(b),window.removeEventListener("resize",z)}),(e,t)=>(j(),D("div",{class:"wrap",ref_key:"wrap",ref:g},[N("canvas",{class:"canvas",ref_key:"canvas",ref:u},null,512)],512))}});const J=O(U,[["__scopeId","data-v-cd9bea0b"]]);export{J as default};
